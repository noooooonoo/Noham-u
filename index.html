<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üèãÔ∏è Mon Coach Sportif</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js"></script>

  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at top left, #0b0f19 0%, #1b1f3b 100%);
      color: white;
      min-height: 100vh;
      overflow-x: hidden;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 50px;
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
    }
    header h1 { color: #00f2fe; font-weight: 800; }
    #loginBtn {
      border: none; background: linear-gradient(90deg, #4facfe, #00f2fe);
      padding: 10px 25px; border-radius: 25px;
      color: white; cursor: pointer; font-weight: 600;
    }
    .main {
      padding: 50px;
      display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px;
    }
    .card {
      background: rgba(255,255,255,0.08); border-radius: 20px; overflow: hidden;
      transition: 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    .card:hover { transform: translateY(-8px) scale(1.02); }
    .card img { width: 100%; height: 180px; object-fit: cover; }
    .card-content { padding: 20px; }
    .card-content h3 { color: #00f2fe; }
    .btn { background: #ff4b2b; border: none; padding: 6px 14px; border-radius: 20px;
           color: white; cursor: pointer; font-size: 0.9em; margin-top: 10px; display: none; }
    .coach .btn { display: inline-block; }
    footer { text-align: center; opacity: 0.6; padding: 20px; }

    .add-btn {
      position: fixed; bottom: 40px; right: 40px;
      background: linear-gradient(90deg, #00f2fe, #4facfe);
      color: white; border: none; padding: 15px 20px;
      border-radius: 50%; font-size: 1.5em; cursor: pointer; display: none;
    }
    .coach .add-btn { display: block; }

    /* modal */
    .modal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6); backdrop-filter: blur(8px);
      display: flex; align-items: center; justify-content: center;
      visibility: hidden; opacity: 0; transition: 0.3s;
    }
    .modal.show { visibility: visible; opacity: 1; }
    .modal-content {
      background: rgba(255,255,255,0.1); border-radius: 15px;
      padding: 25px; width: 90%; max-width: 400px; text-align: center;
    }
    .modal-content input {
      width: 100%; padding: 10px; margin: 10px 0;
      border-radius: 10px; border: none; background: rgba(255,255,255,0.15);
      color: white;
    }
    .modal-content button {
      margin-top: 10px; border: none; background: linear-gradient(90deg,#4facfe,#00f2fe);
      color: white; padding: 10px 20px; border-radius: 20px; cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>üèãÔ∏è Mon Coach Sportif</h1>
    <button id="loginBtn">Connexion Google</button>
  </header>

  <section class="main" id="workouts"></section>
  <button class="add-btn" id="addBtn">+</button>
  <footer>¬© 2025 Mon Coach Sportif</footer>

  <div class="modal" id="workoutModal">
    <div class="modal-content">
      <h2>Nouvel entra√Ænement</h2>
      <input type="text" id="titleInput" placeholder="Nom de la s√©ance">
      <input type="text" id="durationInput" placeholder="Dur√©e (ex: 30 min)">
      <input type="text" id="imageInput" placeholder="Lien image (Unsplash)">
      <button id="saveBtn">Enregistrer</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";

    // ‚úÖ Mets ici ton firebaseConfig
    const firebaseConfig = {
      apiKey: "TA_CLE_API",
      authDomain: "TON_DOMAINE.firebaseapp.com",
      projectId: "TON_PROJECT_ID",
      storageBucket: "TON_PROJECT_ID.appspot.com",
      messagingSenderId: "xxxx",
      appId: "1:xxxx:web:xxxx"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    const loginBtn = document.getElementById('loginBtn');
    const workoutsDiv = document.getElementById('workouts');
    const modal = document.getElementById('workoutModal');
    const addBtn = document.getElementById('addBtn');
    const saveBtn = document.getElementById('saveBtn');

    let userRole = 'eleve';

    // üîê Connexion Google
    loginBtn.addEventListener('click', async () => {
      if (auth.currentUser) {
        await signOut(auth);
        document.body.classList.remove('coach');
        loginBtn.innerText = "Connexion Google";
        return;
      }
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        const isCoach = user.email.toLowerCase().includes("coach");
        userRole = isCoach ? 'coach' : 'eleve';
        document.body.classList.toggle('coach', isCoach);
        loginBtn.innerText = "D√©connexion";
        loadWorkouts();
        alert(`Connect√© : ${user.displayName} (${isCoach ? 'Coach' : '√âl√®ve'})`);
      } catch (e) {
        alert("Erreur de connexion : " + e.message);
      }
    });

    // üì• Charger les entra√Ænements
    async function loadWorkouts() {
      workoutsDiv.innerHTML = "";
      const query = await getDocs(collection(db, "workouts"));
      query.forEach(docSnap => {
        const w = docSnap.data();
        const div = document.createElement('div');
        div.className = "card";
        div.innerHTML = `
          <img src="${w.image}" alt="">
          <div class="card-content">
            <h3>${w.title}</h3>
            <p>Dur√©e : ${w.duration}</p>
            <button class="btn" onclick="deleteWorkout('${docSnap.id}')">Supprimer</button>
          </div>`;
        workoutsDiv.appendChild(div);
      });
    }

    // ‚ûï Ajouter un entra√Ænement (Coach)
    addBtn.onclick = () => { if (userRole === 'coach') modal.classList.add('show'); };
    saveBtn.onclick = async () => {
      const title = document.getElementById('titleInput').value;
      const duration = document.getElementById('durationInput').value;
      const image = document.getElementById('imageInput').value;
      if (!title) return alert("Nom obligatoire");
      await addDoc(collection(db, "workouts"), { title, duration, image });
      modal.classList.remove('show');
      loadWorkouts();
    };
    modal.onclick = e => { if (e.target === modal) modal.classList.remove('show'); };

    // üóëÔ∏è Supprimer (Coach)
    window.deleteWorkout = async (id) => {
      if (userRole !== 'coach') return alert("R√©serv√© au coach !");
      await deleteDoc(doc(db, "workouts", id));
      loadWorkouts();
    };

    // Charge les s√©ances d√®s le d√©part (√©l√®ve non connect√©)
    loadWorkouts();
  </script>
</body>
</html>
